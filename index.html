<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ordem de Produção - Embalagens</title>
    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=iAUhGQDHpk8lYwAM5-BFH1vHli7JCRKOBf7dAfnULm4HDFEcFdhMv_Ft4fW8dh6ccecNDvsoTmmhDhvDHTilxWeMEO4ap8Lusdr71RM6IpMmMEA8I5x18HVpe2grdJveMVilWm0zsdjekn367_znLdMw5Bp6RH-bx1N-xvlaxJCnpJ5rW16HJfh1oDlVvNj_92Y2GqJincGSEBkHvOTSNJTqqf7QyNYW6xJir7_qlZl1zfVtXiGOZRK4X68Z1-DFirA63iXofwhGBfIs6S13pSbxMlI2ylUqDUXG41pTkILDIdV60rXIMWbeIfLOQpKm3lkmfuMjGgnd4WVkUCzqoo2O1wcf_b9YXQY2ojxvu4fOwg_SUudT54svZgXaTxsZLJi9e4d4D5RGP1RrERqdPwPTTNFNPgygwKnbON_L7uC7BKUTvHmfjh7MwcDCU4vGMlvCTMJa2T0PKs5FNjivpTZS0LeydR5TK0k2-7BdQuPPFPBtJvz0J4AvLNMLjVJXhTIX0hHthAs8sB_4rzupsP5pf5bQIF_oznCBvA7BYAPNXOYSCw20ZB1GGPk-t8jq2aXmnFf0X6lZIGgyjyTC7tNz6NAG_dnAcalHxV9LGO2bnjsg2qkGTl9oBNOAcOFXbSnMrmrroL7rEzQXwRcJgzCW3ZCk5ky48RSexP8R4oda0kvSBf5ldHxO_xXxXK1bmmnB_rz0XVqYtFydc4j9eGjLvASSQyv4Jlm-DRArlXxuPX4-I-TheOF6l1KTvdXkRPj9xVNCYA1c9D-uiuxSKBtyCXnadh46ZdpyMu91Ou92GpNT6lxcSl27_NeZC4_UGTCqiY5BnZBkTVywzyL-jxFhXP7R91-UJ0C3TH2wmBQIvVyT3pHC18qNRe4QE7-1rn191DlRQ-5dM8IjPZyqfN9dWWSBJ_LuaaFza_KL1EjSoSrxtxC8GjRjWivDfRah1LaTZKJbgutNyDB0RYnjl23CJlBKtLZ2wM18JGhVvlVsBIJTg2OmhrnBjnk2epjKHIYfeUpymF9z-WppskJg5J9zN92M0b15f9u6c3C8kl6H56biubRO9MYaDEOUpTDu1Q_BVkp0FMzveFsGcvb4Ixj-01BWFqgIM7DbbMrGGrwXKBKZG73a33eKhik66mjl2ppTwZizUJpst129h1c1c6TIc2OAKaLEwrDh6bCPC1YMP10SEroJYbp-pT7f9MIL83JBC23iRVIabFgGSzZSfw786EsMF9yPB-IVJbY9biHe3sHb6uvWYnnaU-3BcYUcwDwE9hgD88LCPrI36N9Doeum-JJyA6IcLNPSK17Q5e1eMXbNcoUlnXAXfZSPi_8cAtA0aCK9Ndv7A6pfPhEBwfwVvEdMzw5m5VSkd4SH3FKY2kYRYBml9OJ5MzTh297gvIijaK6GDP7rrlDhjQzqMuCv2-rNnChF8mt_AR60fe1hsNjEL09i3aZ45XYitmc8cKh4OMwYmv9RhsjZnok7iEqNVtTlMZzMge2fVGB7yXPKB-DGbOJ3Ui2JXbaIl5vVasGwKOrj6vsA1SDkbbpqIVacwmsOoZVl1XM2CWszouzfnytnU-SoBrLoyuO3CNdLK1MEzm09fJwzGxam4wLwXHJJvJv8DjW712csyDnN_89UV3TpYstSEgFwSeHcA1pcI9jMO47ktsDjocrDbh4CnmaprNrVS39XxngWAVcwMKesS5tGMHqpNuZWndO_QfmMjcfXqWX7fdTl0zdEPv1hwJ-VeEmOu1Kpie4lD6DHjYb-jGbR4-EJlSRM-frv0RqFID7gEiRT1UBHsrKt9LCXKSHHyskPYX26G8t36N99PMBwcw2gGwJJGaYatTfUq5_k1n2ePDl3l1k9sa3NGy7nRtQmaUgSVnPIoJ3dkuMo_IKoGvqLZnt3TMVnZhpQ-T2fVIggkP2FL-NLzme5CxWhHoIGKb7Ax7DzIi8pAT4omxS6mTIt9NzCqPFjKVeB-8J0tI64KvE-hZ6cyVlS7EZOJj7ibk3wMoktVlAYZjcD3vsrH8Zo8L_JEsHU26q45oytB8AY617tGsy0iN3nrlSqoMBuuXT3_5Q2_PuEdV_KrVsKsD-B4EWnoocN_yLiKqvLCoHJ1vnkQLVHfI39DNWe0pQ8Tir87irsE5ftYYK6MrSv0rkOPnfAJEE9RaUB9yGFLMHMI8PsCrcLCNh3R7_5Rk2v8PIRXK5VDgfJfg43Gn1vfrTzbfXcUmpmm3PSmm-BCYpPwZbBmKtCVmdnsh_dq5yTRYm2POhB5hIJXDbC-inBUjZguGUAUPIJ-Hq8kqpU5VVZre-vJyiv8FLhJC34i2FPymnW9ZQuAw3KoWxjBFgaCVwBWHElCBPAV5spY5Pb" charset="UTF-8"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:#333}
        .container{max-width:1400px;margin:0 auto;padding:20px}
        .header{background:rgba(255,255,255,.95);padding:20px;border-radius:15px;margin-bottom:30px;box-shadow:0 10px 30px rgba(0,0,0,.1);text-align:center}
        .header h1{color:#2c3e50;font-size:2.5em;margin-bottom:10px;font-weight:700}
        .header p{color:#7f8c8d;font-size:1.2em}

        .stats-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:30px}
        .stat-card{background:rgba(255,255,255,.9);padding:20px;border-radius:10px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,.1)}
        .stat-number{font-size:2.5em;font-weight:bold;margin-bottom:5px}
        .stat-label{color:#6c757d;font-size:.9em;text-transform:uppercase}

        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px}
        .card{background:rgba(255,255,255,.95);padding:25px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
        .card h2{color:#2c3e50;margin-bottom:20px;font-size:1.8em;display:flex;align-items:center;gap:10px}

        .form-group{margin-bottom:20px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px}
        .form-group label{display:block;margin-bottom:8px;font-weight:600;color:#34495e}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:12px 15px;border:2px solid #e0e6ed;border-radius:8px;font-size:16px;transition:all .3s ease;background:#f8f9fa}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.1)}
        .form-group textarea{height:100px;resize:vertical}

        .image-upload{border:3px dashed #ddd;border-radius:10px;padding:20px;text-align:center;cursor:pointer;transition:all .3s ease;background:#f8f9fa}
        .image-upload:hover{border-color:#667eea;background:#f0f4ff}
        .image-upload.dragover{border-color:#667eea;background:#e8f2ff}
        .image-preview{max-width:100%;max-height:200px;border-radius:8px;margin-top:10px;box-shadow:0 4px 15px rgba(0,0,0,.1)}

        .product-selector{background:#e8f4fd;border:2px solid #74b9ff;border-radius:10px;padding:15px;margin-bottom:20px}
        .product-selector h3{color:#2c3e50;margin-bottom:15px;display:flex;align-items:center;gap:10px}
        .product-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:10px;max-height:200px;overflow-y:auto}
        .product-item{background:#fff;border:2px solid #e0e6ed;border-radius:8px;padding:12px;cursor:pointer;transition:all .3s ease}
        .product-item:hover{border-color:#667eea;background:#f8f9ff}
        .product-item.selected{border-color:#667eea;background:#e8f2ff}
        .product-name{font-weight:600;color:#2c3e50;margin-bottom:5px}
        .product-details{font-size:12px;color:#6c757d}
        .clear-selection{background:#fd79a8;color:#fff;border:none;padding:8px 15px;border-radius:6px;font-size:14px;cursor:pointer;margin-top:10px}

        .template-actions{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
        .btn{padding:12px 25px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;text-transform:uppercase;letter-spacing:.5px}
        .btn-primary{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}
        .btn-primary:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(102,126,234,.3)}
        .btn-success{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%);color:#fff}
        .btn-success:hover{transform:translateY(-2px);box-shadow:0 10px 25px rgba(17,153,142,.3)}
        .btn-warning{background:linear-gradient(135deg,#ffeaa7 0%,#fab1a0 100%);color:#2d3436}
        .btn-danger{background:linear-gradient(135deg,#fd79a8 0%,#e84393 100%);color:#fff}
        .btn-info{background:linear-gradient(135deg,#74b9ff 0%,#0984e3 100%);color:#fff}
        .btn-secondary{background:linear-gradient(135deg,#636e72 0%,#2d3436 100%);color:#fff}
        .btn-small{padding:8px 15px;font-size:14px}

        .orders-list{grid-column:1 / -1}
        .list-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:15px}
        .filter-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
        .filter-controls select,.filter-controls input{padding:8px 12px;border:2px solid #e0e6ed;border-radius:6px;font-size:14px}

        .order-item{background:#fff;padding:20px;margin-bottom:15px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,.08);border-left:5px solid #667eea}
        .order-item.priority-high{border-left-color:#e74c3c}
        .order-item.priority-medium{border-left-color:#f39c12}
        .order-item.priority-low{border-left-color:#27ae60}
        .order-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px}
        .order-id{font-weight:bold;color:#2c3e50;font-size:1.2em}
        .status{padding:5px 15px;border-radius:20px;font-weight:600;text-transform:uppercase;font-size:12px}
        .status.em-andamento{background:#ffeaa7;color:#2d3436}
        .status.finalizado{background:#55efc4;color:#2d3436}
        .priority{padding:3px 8px;border-radius:15px;font-size:11px;font-weight:600;text-transform:uppercase}
        .priority.alta{background:#ffebee;color:#c62828}
        .priority.media{background:#fff8e1;color:#f57c00}
        .priority.baixa{background:#e8f5e8;color:#2e7d32}

        .process-flow{display:flex;gap:10px;margin:15px 0;flex-wrap:wrap}
        .process-step{padding:8px 15px;background:#f8f9fa;border-radius:20px;font-size:14px;border:2px solid #e9ecef}
        .process-step.completed{background:#d4edda;border-color:#c3e6cb;color:#155724}
        .process-step.current{background:#fff3cd;border-color:#ffeaa7;color:#856404}

        .order-details{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin:15px 0}
        .detail-item{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee}
        .detail-label{font-weight:600;color:#6c757d}

        .order-images{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin:15px 0}
        .order-image{text-align:center}
        .order-image img{max-width:100%;max-height:150px;border-radius:8px;box-shadow:0 4px 15px rgba(0,0,0,.1)}

        .order-actions{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}

        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.5)}
        .modal-content{background:#fff;margin:5% auto;padding:20px;border-radius:15px;width:90%;max-width:600px;max-height:80vh;overflow-y:auto}
        .modal-content.large{max-width:900px}
        .close{color:#aaa;float:right;font-size:28px;font-weight:bold;cursor:pointer}
        .close:hover{color:#000}

        .print-preview{background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 20px rgba(0,0,0,.1)}
        .print-header{text-align:center;margin-bottom:20px;border-bottom:3px solid #667eea;padding-bottom:12px}
        .print-images{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin:18px 0}
        .print-image{text-align:center}
        .print-image img{max-width:100%;max-height:300px;border:2px solid #ddd;border-radius:10px}

        .export-options{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap}

        .edit-form{background:#fff;padding:30px;border-radius:15px}
        .edit-form h2{color:#2c3e50;margin-bottom:25px;font-size:1.8em;text-align:center;border-bottom:2px solid #667eea;padding-bottom:15px}
        .edit-actions{display:flex;gap:15px;justify-content:center;margin-top:30px;padding-top:20px;border-top:1px solid #eee}
        .current-image-preview{max-width:150px;max-height:150px;border-radius:8px;margin:10px 0;border:2px solid #ddd}

        @media print{
            @page { size: A4 portrait; margin:10mm; }
            *{-webkit-print-color-adjust:exact !important;color-adjust:exact !important;print-color-adjust:exact !important}
            body{background:#fff !important}
            .container,.header,.stats-row,.main-content,.orders-list,.modal-content>div:last-child{display:none !important}
            .modal{display:block !important;position:static !important;background:#fff !important;width:100% !important;height:auto !important}
            .modal-content{margin:0 !important;padding:0 !important;width:100% !important;max-width:100% !important;max-height:none !important;background:#fff !important;box-shadow:none !important;border-radius:0 !important}
            .print-preview{display:block !important;visibility:visible !important;padding:10px !important;margin:0 !important;background:#fff !important;box-shadow:none !important;border-radius:0 !important}
            .print-preview *{visibility:visible !important}
            .print-header h1,.print-header h2,.print-header p{color:#000 !important;margin:4px 0 !important}
            .print-preview,.print-preview *{break-inside:avoid-page !important;page-break-inside:avoid !important}
            .print-preview{font-size:13px !important;line-height:1.35 !important}
            .print-images img{max-height:220px !important}
            .print-images{gap:10px !important;margin:10px 0 !important}
            .close{display:none !important}
            .print-preview table{border-collapse:collapse !important;width:100% !important}
            .print-preview td{border-bottom:1px solid #ddd !important;padding:6px 0 !important}
        }

        @media (max-width:768px){
            .main-content{grid-template-columns:1fr}
            .form-row{grid-template-columns:1fr}
            .order-details{grid-template-columns:1fr}
            .order-images{grid-template-columns:1fr}
            .print-images{grid-template-columns:1fr}
            .stats-row{grid-template-columns:repeat(2,1fr)}
            .filter-controls{justify-content:center}
            .edit-actions{flex-direction:column;align-items:center}
            .product-list{grid-template-columns:1fr}
            .template-actions{justify-content:center}
        }

        .notification{position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:8px;color:#fff;font-weight:600;z-index:2000;transform:translateX(400px);transition:transform .3s ease}
        .notification.show{transform:translateX(0)}
        .notification.success{background:linear-gradient(135deg,#11998e 0%,#38ef7d 100%)}
        .notification.error{background:linear-gradient(135deg,#fd79a8 0%,#e84393 100%)}
        .notification.info{background:linear-gradient(135deg,#74b9ff 0%,#0984e3 100%)}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏭 Sistema de Ordem de Produção</h1>
            <p>Gestão Completa de Embalagens em Papel Cartão</p>
        </div>

        <!-- Estatísticas -->
        <div class="stats-row">
            <div class="stat-card"><div class="stat-number" style="color:#667eea;" id="totalOrders">0</div><div class="stat-label">Total de Ordens</div></div>
            <div class="stat-card"><div class="stat-number" style="color:#f39c12;" id="inProgressOrders">0</div><div class="stat-label">Em Andamento</div></div>
            <div class="stat-card"><div class="stat-number" style="color:#27ae60;" id="completedOrders">0</div><div class="stat-label">Finalizadas</div></div>
            <div class="stat-card"><div class="stat-number" style="color:#e74c3c;" id="totalProducts">0</div><div class="stat-label">Produtos Únicos</div></div>
        </div>

        <div class="main-content">
            <div class="card">
                <h2>📝 Nova Ordem de Produção</h2>

                <div class="product-selector">
                    <h3>🗂️ Produtos Anteriores</h3>
                    <div class="template-actions">
                        <button class="btn btn-info btn-small" onclick="showProductHistory()">📋 Ver Histórico</button>
                        <button class="btn btn-warning btn-small" onclick="clearForm()">🗑️ Limpar Formulário</button>
                        <button class="btn btn-secondary btn-small" onclick="saveAsTemplate()">💾 Salvar como Modelo</button>
                    </div>
                    <div id="productList" class="product-list" style="display:none;"></div>
                    <button id="clearSelectionBtn" class="clear-selection" onclick="clearSelection()" style="display:none;">❌ Limpar Seleção</button>
                </div>

                <form id="orderForm">
                    <!-- Nome do produto no topo -->
                    <div class="form-group">
                        <label for="nomeTemplate">Nome do Produto (para histórico)</label>
                        <input type="text" id="nomeTemplate" placeholder="Ex: Caixa Pizza Grande, Sacola Kraft, etc." required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="medidasFolha">Medidas da Folha Inteira</label>
                            <input type="text" id="medidasFolha" placeholder="Ex: 70x100cm" required>
                        </div>
                        <div class="form-group">
                            <label for="quantidade">Quantidade de Impressão</label>
                            <input type="number" id="quantidade" placeholder="1000" required>
                        </div>
                    </div>

                    <!-- NOVO CAMPO: Quantidade de folhas/resma -->
                    <div class="form-row">
                        <div class="form-group" style="grid-column:1 / -1;">
                            <label for="folhasResma">Quantidade de folhas/resma</label>
                            <input type="text" id="folhasResma" placeholder="Ex: 500 folhas (2 remas com 250)">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="fornecedor">Fornecedor (Terceirização)</label>
                            <input type="text" id="fornecedor" placeholder="Nome do fornecedor">
                        </div>
                        <div class="form-group">
                            <label for="status">Status</label>
                            <select id="status" required>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Finalizado">Finalizado</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoPapel">Tipo de Papel</label>
                            <input type="text" id="tipoPapel" placeholder="Ex: Cartão Duplex" required>
                        </div>
                        <div class="form-group">
                            <label for="gramatura">Gramatura do Papel</label>
                            <input type="text" id="gramatura" placeholder="Ex: 300g/m²" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="impressao">Tipo de Impressão</label>
                            <select id="impressao" required>
                                <option value="Frente 4x0">Frente 4x0</option>
                                <option value="Frente e Verso 4x4">Frente e Verso 4x4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="prioridade">Prioridade</label>
                            <select id="prioridade" required>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                                <option value="Baixa">Baixa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="acabamento">Acabamento</label>
                        <textarea id="acabamento" placeholder="Descreva os acabamentos (quebras de linha serão preservadas no PDF)" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="descricaoEmbalagens">Descrição das Embalagens na Faca</label>
                        <textarea id="descricaoEmbalagens" placeholder="Descreva as embalagens que estão na faca (formatação preservada no PDF)" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Imagem da Faca</label>
                            <div class="image-upload" onclick="document.getElementById('imagemFaca').click()">
                                <input type="file" id="imagemFaca" accept="image/*" style="display:none;">
                                <p>📁 Clique para selecionar a imagem da faca</p>
                                <img id="previewFaca" class="image-preview" style="display:none;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Imagem da Montagem da Arte</label>
                            <div class="image-upload" onclick="document.getElementById('imagemArte').click()">
                                <input type="file" id="imagemArte" accept="image/*" style="display:none;">
                                <p>🎨 Clique para selecionar a imagem da arte</p>
                                <img id="previewArte" class="image-preview" style="display:none;">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="width:100%;margin-top:20px;">✅ Criar Ordem de Produção</button>
                </form>
            </div>

            <div class="card">
                <h2>📊 Processo de Produção</h2>
                <div class="process-flow">
                    <div class="process-step">1. Corte e Vinco</div>
                    <div class="process-step">2. Desmolde</div>
                    <div class="process-step">3. Acabamento</div>
                    <div class="process-step">4. Selagem</div>
                    <div class="process-step">5. Prateleira</div>
                </div>
                <p style="margin-top:20px;color:#6c757d;line-height:1.6;">
                    <strong>Fluxo Padrão:</strong> Todas as embalagens seguem este processo sequencial.
                    Cada etapa deve ser concluída antes de passar para a próxima.
                </p>

                <div style="margin-top:30px;">
                    <h3 style="margin-bottom:15px;">🔧 Ações Rápidas</h3>
                    <div class="export-options">
                        <button class="btn btn-info" onclick="exportData()">📊 Exportar Dados</button>
                        <button class="btn btn-warning" onclick="importData()">📥 Importar Dados</button>
                        <button class="btn btn-danger" onclick="clearAllData()">🗑️ Limpar Tudo</button>
                        <button class="btn btn-secondary" onclick="manageTemplates()">🗂️ Gerenciar Modelos</button>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display:none;" onchange="handleImport(event)">
                </div>
            </div>
        </div>

        <div class="card orders-list">
            <div class="list-header">
                <h2>📋 Ordens de Produção</h2>
                <div class="filter-controls">
                    <select id="filterStatus" onchange="filterOrders()">
                        <option value="">Todos os Status</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Finalizado">Finalizado</option>
                    </select>
                    <select id="filterPriority" onchange="filterOrders()">
                        <option value="">Todas as Prioridades</option>
                        <option value="Alta">Alta</option>
                        <option value="Média">Média</option>
                        <option value="Baixa">Baixa</option>
                    </select>
                    <input type="text" id="searchOrders" placeholder="Buscar..." onkeyup="filterOrders()">
                </div>
            </div>
            <div id="ordersList"></div>
        </div>
    </div>

    <!-- Modal para impressão -->
    <div id="printModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePrintModal()">&times;</span>
            <div id="printContent" class="print-preview"></div>
            <div style="text-align:center;margin-top:20px;padding-top:20px;border-top:1px solid #ddd;">
                <button class="btn btn-primary" onclick="printOrder()">🖨️ Imprimir Ordem</button>
                <button class="btn btn-warning" onclick="closePrintModal()">❌ Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal para edição -->
    <div id="editModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <div class="edit-form">
                <h2>✏️ Editar Ordem de Produção</h2>
                <form id="editForm">
                    <input type="hidden" id="editOrderId">

                    <div class="form-group">
                        <label for="editNomeTemplate">Nome do Produto</label>
                        <input type="text" id="editNomeTemplate" placeholder="Nome do produto" required>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editMedidasFolha">Medidas da Folha Inteira</label>
                            <input type="text" id="editMedidasFolha" placeholder="Ex: 70x100cm" required>
                        </div>
                        <div class="form-group">
                            <label for="editQuantidade">Quantidade de Impressão</label>
                            <input type="number" id="editQuantidade" placeholder="1000" required>
                        </div>
                    </div>

                    <!-- NOVO CAMPO (edição): Quantidade de folhas/resma -->
                    <div class="form-row">
                        <div class="form-group" style="grid-column:1 / -1;">
                            <label for="editFolhasResma">Quantidade de folhas/resma</label>
                            <input type="text" id="editFolhasResma" placeholder="Ex: 500 folhas (2 remas com 250)">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editFornecedor">Fornecedor (Terceirização)</label>
                            <input type="text" id="editFornecedor" placeholder="Nome do fornecedor">
                        </div>
                        <div class="form-group">
                            <label for="editStatus">Status</label>
                            <select id="editStatus" required>
                                <option value="Em Andamento">Em Andamento</option>
                                <option value="Finalizado">Finalizado</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editTipoPapel">Tipo de Papel</label>
                            <input type="text" id="editTipoPapel" placeholder="Ex: Cartão Duplex" required>
                        </div>
                        <div class="form-group">
                            <label for="editGramatura">Gramatura do Papel</label>
                            <input type="text" id="editGramatura" placeholder="Ex: 300g/m²" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editImpressao">Tipo de Impressão</label>
                            <select id="editImpressao" required>
                                <option value="Frente 4x0">Frente 4x0</option>
                                <option value="Frente e Verso 4x4">Frente e Verso 4x4</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editPrioridade">Prioridade</label>
                            <select id="editPrioridade" required>
                                <option value="Média">Média</option>
                                <option value="Alta">Alta</option>
                                <option value="Baixa">Baixa</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="editAcabamento">Acabamento</label>
                        <textarea id="editAcabamento" placeholder="Descreva os acabamentos necessários" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="editDescricaoEmbalagens">Descrição das Embalagens na Faca</label>
                        <textarea id="editDescricaoEmbalagens" placeholder="Descreva as embalagens que estão na faca" required></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Imagem da Faca</label>
                            <div id="currentImageFaca" style="text-align:center;margin:10px 0;"></div>
                            <div class="image-upload" onclick="document.getElementById('editImagemFaca').click()">
                                <input type="file" id="editImagemFaca" accept="image/*" style="display:none;">
                                <p>📁 Clique para alterar a imagem da faca</p>
                                <img id="editPreviewFaca" class="image-preview" style="display:none;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Imagem da Montagem da Arte</label>
                            <div id="currentImageArte" style="text-align:center;margin:10px 0;"></div>
                            <div class="image-upload" onclick="document.getElementById('editImagemArte').click()">
                                <input type="file" id="editImagemArte" accept="image/*" style="display:none;">
                                <p>🎨 Clique para alterar a imagem da arte</p>
                                <img id="editPreviewArte" class="image-preview" style="display:none;">
                            </div>
                        </div>
                    </div>

                    <div class="edit-actions">
                        <button type="submit" class="btn btn-success">💾 Salvar Alterações</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">❌ Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para gerenciar modelos -->
    <div id="templatesModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeTemplatesModal()">&times;</span>
            <div style="padding:20px;">
                <h2 style="text-align:center;margin-bottom:30px;">🗂️ Gerenciar Modelos de Produtos</h2>
                <div id="templatesContent"></div>
                <div style="text-align:center;margin-top:20px;">
                    <button class="btn btn-warning" onclick="closeTemplatesModal()">❌ Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificações -->
    <div id="notification" class="notification"></div>

    <script>
        let orders = JSON.parse(localStorage.getItem('productionOrders')) || [];
        let orderIdCounter = parseInt(localStorage.getItem('orderIdCounter')) || 1;
        let productTemplates = JSON.parse(localStorage.getItem('productTemplates')) || [];
        let isEditing = false;
        let selectedTemplate = null;

        function showNotification(message,type='success'){const n=document.getElementById('notification');n.textContent=message;n.className=`notification ${type}`;n.classList.add('show');setTimeout(()=>n.classList.remove('show'),3000);}
        function generateOrderId(){const id=orderIdCounter;orderIdCounter++;localStorage.setItem('orderIdCounter',orderIdCounter);return `OP-${String(id).padStart(4,'0')}`;}
        function updateStats(){const total=orders.length;const emAndamento=orders.filter(o=>o.status==='Em Andamento').length;const finalizadas=orders.filter(o=>o.status==='Finalizado').length;const unicos=new Set(orders.map(o=>o.nomeTemplate)).size;document.getElementById('totalOrders').textContent=total;document.getElementById('inProgressOrders').textContent=emAndamento;document.getElementById('completedOrders').textContent=finalizadas;document.getElementById('totalProducts').textContent=unicos;}

        function showProductHistory(){
            const list=document.getElementById('productList');
            if(productTemplates.length===0){showNotification('Nenhum produto salvo no histórico ainda.','info');return;}
            list.innerHTML=productTemplates.map((t,i)=>`
                <div class="product-item" onclick="selectTemplate(${i})">
                    <div class="product-name">${t.nomeTemplate}</div>
                    <div class="product-details">${t.tipoPapel} | ${t.gramatura} | ${t.impressao}</div>
                </div>`).join('');
            list.style.display='grid';document.getElementById('clearSelectionBtn').style.display='block';
        }
        function selectTemplate(i){selectedTemplate=productTemplates[i];document.querySelectorAll('.product-item').forEach(it=>it.classList.remove('selected'));document.querySelectorAll('.product-item')[i].classList.add('selected');fillFormWithTemplate(selectedTemplate);showNotification(`Produto "${selectedTemplate.nomeTemplate}" carregado!`,'success');}
        function fillFormWithTemplate(t){
            document.getElementById('medidasFolha').value=t.medidasFolha||'';
            document.getElementById('fornecedor').value=t.fornecedor||'';
            document.getElementById('tipoPapel').value=t.tipoPapel||'';
            document.getElementById('gramatura').value=t.gramatura||'';
            document.getElementById('impressao').value=t.impressao||'Frente 4x0';
            document.getElementById('prioridade').value=t.prioridade||'Média';
            document.getElementById('nomeTemplate').value=t.nomeTemplate||'';
            document.getElementById('folhasResma').value=t.folhasResma||'';
            document.getElementById('acabamento').value=t.acabamento||'';
            document.getElementById('descricaoEmbalagens').value=t.descricaoEmbalagens||'';
            if(t.imagemFaca){const p=document.getElementById('previewFaca');p.src=t.imagemFaca;p.style.display='block';}
            if(t.imagemArte){const p=document.getElementById('previewArte');p.src=t.imagemArte;p.style.display='block';}
        }
        function clearSelection(){selectedTemplate=null;document.querySelectorAll('.product-item').forEach(it=>it.classList.remove('selected'));document.getElementById('productList').style.display='none';document.getElementById('clearSelectionBtn').style.display='none';}
        function clearForm(){document.getElementById('orderForm').reset();document.getElementById('previewFaca').style.display='none';document.getElementById('previewArte').style.display='none';clearSelection();showNotification('Formulário limpo!','info');}

        function saveAsTemplate(){
            const nome=document.getElementById('nomeTemplate').value.trim();
            if(!nome){showNotification('Digite o nome do produto antes de salvar como modelo.','error');return;}
            const t={nomeTemplate:nome,medidasFolha:document.getElementById('medidasFolha').value,fornecedor:document.getElementById('fornecedor').value,tipoPapel:document.getElementById('tipoPapel').value,gramatura:document.getElementById('gramatura').value,impressao:document.getElementById('impressao').value,prioridade:document.getElementById('prioridade').value,folhasResma:document.getElementById('folhasResma').value,acabamento:document.getElementById('acabamento').value,descricaoEmbalagens:document.getElementById('descricaoEmbalagens').value,imagemFaca:document.getElementById('previewFaca').src||null,imagemArte:document.getElementById('previewArte').src||null,dataCriacao:new Date().toLocaleDateString('pt-BR'),vezesCriado:1};
            const idx=productTemplates.findIndex(x=>x.nomeTemplate===nome);
            if(idx!==-1){if(confirm(`Já existe um modelo com o nome "${nome}". Deseja atualizar?`)){productTemplates[idx]={...t,vezesCriado:productTemplates[idx].vezesCriado+1};showNotification(`Modelo "${nome}" atualizado!`,'success');}}
            else{productTemplates.push(t);showNotification(`Modelo "${nome}" salvo no histórico!`,'success');}
            localStorage.setItem('productTemplates',JSON.stringify(productTemplates));
        }

        function manageTemplates(){
            const el=document.getElementById('templatesContent');
            if(productTemplates.length===0){el.innerHTML='<p style="text-align:center;padding:40px;color:#6c757d;">Nenhum modelo salvo ainda.</p>';}
            else{
                el.innerHTML=`<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:15px;">${
                    productTemplates.map((t,i)=>`
                        <div style="background:#f8f9fa;border:2px solid #e9ecef;border-radius:10px;padding:15px;">
                            <h4 style="color:#2c3e50;margin-bottom:10px;">${t.nomeTemplate}</h4>
                            <p style="font-size:14px;color:#6c757d;margin-bottom:10px;">
                                <strong>Papel:</strong> ${t.tipoPapel}<br>
                                <strong>Gramatura:</strong> ${t.gramatura}<br>
                                <strong>Impressão:</strong> ${t.impressao}<br>
                                ${t.folhasResma?`<strong>Folhas/Resma:</strong> ${t.folhasResma}<br>`:''}
                                <strong>Criado:</strong> ${t.dataCriacao}<br>
                                <strong>Usado:</strong> ${t.vezesCriado} vez(es)
                            </p>
                            <div style="display:flex;gap:5px;flex-wrap:wrap;">
                                <button class="btn btn-info btn-small" onclick="useTemplate(${i})">🔄 Usar</button>
                                <button class="btn btn-danger btn-small" onclick="deleteTemplate(${i})">🗑️ Excluir</button>
                            </div>
                        </div>`).join('')
                }</div>`;
            }
            document.getElementById('templatesModal').style.display='block';
        }
        function useTemplate(i){fillFormWithTemplate(productTemplates[i]);closeTemplatesModal();showNotification(`Modelo "${productTemplates[i].nomeTemplate}" carregado!`,'success');}
        function deleteTemplate(i){const t=productTemplates[i];if(confirm(`Tem certeza que deseja excluir o modelo "${t.nomeTemplate}"?`)){productTemplates.splice(i,1);localStorage.setItem('productTemplates',JSON.stringify(productTemplates));manageTemplates();showNotification(`Modelo "${t.nomeTemplate}" excluído!`,'info');}}
        function closeTemplatesModal(){document.getElementById('templatesModal').style.display='none';}

        function imageToBase64(file,cb){const r=new FileReader();r.onload=e=>cb(e.target.result);r.readAsDataURL(file);}
        document.getElementById('imagemFaca').addEventListener('change',e=>{const f=e.target.files[0];const p=document.getElementById('previewFaca');if(f){const r=new FileReader();r.onload=ev=>{p.src=ev.target.result;p.style.display='block';};r.readAsDataURL(f);}});
        document.getElementById('imagemArte').addEventListener('change',e=>{const f=e.target.files[0];const p=document.getElementById('previewArte');if(f){const r=new FileReader();r.onload=ev=>{p.src=ev.target.result;p.style.display='block';};r.readAsDataURL(f);}});

        document.querySelectorAll('.image-upload').forEach(u=>{
            u.addEventListener('dragover',e=>{e.preventDefault();u.classList.add('dragover');});
            u.addEventListener('dragleave',e=>{e.preventDefault();u.classList.remove('dragover');});
            u.addEventListener('drop',e=>{e.preventDefault();u.classList.remove('dragover');const files=e.dataTransfer.files;if(files.length>0){const input=u.querySelector('input[type="file"]');input.files=files;input.dispatchEvent(new Event('change'));}});
        });

        document.getElementById('orderForm').addEventListener('submit',function(e){
            e.preventDefault();
            const imgF=document.getElementById('imagemFaca').files[0];
            const imgA=document.getElementById('imagemArte').files[0];
            const order={
                id:generateOrderId(),
                medidasFolha:document.getElementById('medidasFolha').value,
                quantidade:document.getElementById('quantidade').value,
                folhasResma:document.getElementById('folhasResma').value,
                fornecedor:document.getElementById('fornecedor').value,
                status:document.getElementById('status').value,
                tipoPapel:document.getElementById('tipoPapel').value,
                gramatura:document.getElementById('gramatura').value,
                impressao:document.getElementById('impressao').value,
                prioridade:document.getElementById('prioridade').value,
                nomeTemplate:document.getElementById('nomeTemplate').value,
                acabamento:document.getElementById('acabamento').value,
                descricaoEmbalagens:document.getElementById('descricaoEmbalagens').value,
                dataCreated:new Date().toLocaleDateString('pt-BR'),
                timeCreated:new Date().toLocaleTimeString('pt-BR'),
                currentStep:0,
                imagemFaca:null,
                imagemArte:null
            };
            let processed=0;const total=(imgF?1:0)+(imgA?1:0);
            function saveOrder(){orders.push(order);localStorage.setItem('productionOrders',JSON.stringify(orders));saveAsTemplate();displayOrders();updateStats();document.getElementById('orderForm').reset();document.getElementById('previewFaca').style.display='none';document.getElementById('previewArte').style.display='none';clearSelection();showNotification('✅ Ordem de produção criada com sucesso!','success');}
            if(total===0){saveOrder();return;}
            if(imgF){imageToBase64(imgF,b64=>{order.imagemFaca=b64;processed++;if(processed===total)saveOrder();});}
            if(imgA){imageToBase64(imgA,b64=>{order.imagemArte=b64;processed++;if(processed===total)saveOrder();});}
        });

        document.getElementById('editForm').addEventListener('submit',function(e){
            e.preventDefault();
            const id=document.getElementById('editOrderId').value;
            const idx=orders.findIndex(o=>o.id===id);
            if(idx===-1){showNotification('Erro: Ordem não encontrada!','error');return;}
            const order=orders[idx];
            const imgF=document.getElementById('editImagemFaca')?.files?.[0];
            const imgA=document.getElementById('editImagemArte')?.files?.[0];

            order.medidasFolha=document.getElementById('editMedidasFolha').value;
            order.quantidade=document.getElementById('editQuantidade').value;
            order.folhasResma=document.getElementById('editFolhasResma').value;
            order.fornecedor=document.getElementById('editFornecedor').value;
            order.status=document.getElementById('editStatus').value;
            order.tipoPapel=document.getElementById('editTipoPapel').value;
            order.gramatura=document.getElementById('editGramatura').value;
            order.impressao=document.getElementById('editImpressao').value;
            order.prioridade=document.getElementById('editPrioridade').value;
            order.nomeTemplate=document.getElementById('editNomeTemplate').value;
            order.acabamento=document.getElementById('editAcabamento').value;
            order.descricaoEmbalagens=document.getElementById('editDescricaoEmbalagens').value;
            order.lastModified=new Date().toLocaleDateString('pt-BR')+' às '+new Date().toLocaleTimeString('pt-BR');

            let processed=0;const total=(imgF?1:0)+(imgA?1:0);
            function finish(){orders[idx]=order;localStorage.setItem('productionOrders',JSON.stringify(orders));displayOrders();updateStats();closeEditModal();showNotification(`✅ Ordem ${id} atualizada com sucesso!`,'success');}
            if(total===0){finish();return;}
            if(imgF){imageToBase64(imgF,b64=>{order.imagemFaca=b64;processed++;if(processed===total)finish();});}
            if(imgA){imageToBase64(imgA,b64=>{order.imagemArte=b64;processed++;if(processed===total)finish();});}
        });

        function editOrder(orderId){
            const order=orders.find(o=>o.id===orderId);
            if(!order){showNotification('Erro: Ordem não encontrada!','error');return;}
            isEditing=true;
            document.getElementById('editOrderId').value=order.id;
            document.getElementById('editMedidasFolha').value=order.medidasFolha;
            document.getElementById('editQuantidade').value=order.quantidade;
            document.getElementById('editFornecedor').value=order.fornecedor||'';
            document.getElementById('editStatus').value=order.status;
            document.getElementById('editTipoPapel').value=order.tipoPapel;
            document.getElementById('editGramatura').value=order.gramatura;
            document.getElementById('editImpressao').value=order.impressao;
            document.getElementById('editPrioridade').value=order.prioridade||'Média';
            document.getElementById('editNomeTemplate').value=order.nomeTemplate||'';
            document.getElementById('editAcabamento').value=order.acabamento;
            document.getElementById('editDescricaoEmbalagens').value=order.descricaoEmbalagens;
            document.getElementById('editFolhasResma').value=order.folhasResma||'';

            const ciF=document.getElementById('currentImageFaca');
            const ciA=document.getElementById('currentImageArte');
            ciF.innerHTML=order.imagemFaca?`<p><strong>Imagem Atual da Faca:</strong></p><img src="${order.imagemFaca}" alt="Faca Atual" class="current-image-preview">`:'<p style="color:#999;">Nenhuma imagem da faca cadastrada</p>';
            ciA.innerHTML=order.imagemArte?`<p><strong>Imagem Atual da Arte:</strong></p><img src="${order.imagemArte}" alt="Arte Atual" class="current-image-preview">`:'<p style="color:#999;">Nenhuma imagem da arte cadastrada</p>';

            document.getElementById('editPreviewFaca').style.display='none';
            document.getElementById('editPreviewArte').style.display='none';
            document.getElementById('editImagemFaca').value='';
            document.getElementById('editImagemArte').value='';
            document.getElementById('editModal').style.display='block';
            showNotification(`Editando ordem ${orderId}`,'info');
        }
        function closeEditModal(){document.getElementById('editModal').style.display='none';isEditing=false;}

        function filterOrders(){
            const st=document.getElementById('filterStatus').value;
            const pr=document.getElementById('filterPriority').value;
            const q=document.getElementById('searchOrders').value.toLowerCase();
            let filtered=orders.filter(order=>{
                const sOK=!st||order.status===st;
                const pOK=!pr||order.prioridade===pr;
                const qOK=!q||order.id.toLowerCase().includes(q)||order.tipoPapel.toLowerCase().includes(q)||order.acabamento.toLowerCase().includes(q)||order.descricaoEmbalagens.toLowerCase().includes(q)||(order.nomeTemplate&&order.nomeTemplate.toLowerCase().includes(q));
                return sOK&&pOK&&qOK;
            });
            displayOrdersList(filtered);
        }

        function displayOrdersList(list=orders){
            const el=document.getElementById('ordersList');
            if(list.length===0){el.innerHTML='<p style="text-align:center;color:#6c757d;padding:40px;">Nenhuma ordem encontrada.</p>';return;}
            el.innerHTML=list.map(order=>{
                const processSteps=['Corte e Vinco','Desmolde','Acabamento','Selagem','Prateleira'];
                const pClass=order.prioridade?order.prioridade.toLowerCase():'media';
                return `
                <div class="order-item priority-${pClass==='média'?'medium':pClass==='alta'?'high':'low'}">
                    <div class="order-header">
                        <div>
                            <span class="order-id">${order.id}</span>
                            ${order.nomeTemplate?`<span style="background:#e8f4fd;color:#2c3e50;padding:3px 8px;border-radius:12px;font-size:12px;margin-left:10px;">📦 ${order.nomeTemplate}</span>`:''}
                            <span class="priority ${pClass}">${order.prioridade||'Média'}</span>
                            <span style="margin-left:15px;color:#6c757d;">${order.dataCreated} ${order.timeCreated?'às '+order.timeCreated:''}</span>
                            ${order.lastModified?`<span style="margin-left:10px;color:#e67e22;font-size:12px;">(Editado: ${order.lastModified})</span>`:''}
                        </div>
                        <span class="status ${order.status.toLowerCase().replace(' ','-')}">${order.status}</span>
                    </div>

                    <div class="process-flow">
                        ${processSteps.map((s,i)=>`<div class="process-step ${i<order.currentStep?'completed':i===order.currentStep?'current':''}">${i+1}. ${s}</div>`).join('')}
                    </div>

                    <div class="order-details">
                        <div class="detail-item"><span class="detail-label">Medidas:</span><span>${order.medidasFolha}</span></div>
                        <div class="detail-item"><span class="detail-label">Quantidade:</span><span>${parseInt(order.quantidade).toLocaleString()}</span></div>
                        ${order.folhasResma?`<div class="detail-item"><span class="detail-label">Folhas/Resma:</span><span>${order.folhasResma}</span></div>`:''}
                        <div class="detail-item"><span class="detail-label">Papel:</span><span>${order.tipoPapel}</span></div>
                        <div class="detail-item"><span class="detail-label">Gramatura:</span><span>${order.gramatura}</span></div>
                        <div class="detail-item"><span class="detail-label">Impressão:</span><span>${order.impressao}</span></div>
                        ${order.fornecedor?`<div class="detail-item"><span class="detail-label">Fornecedor:</span><span>${order.fornecedor}</span></div>`:''}
                    </div>

                    ${order.imagemFaca||order.imagemArte?`
                    <div class="order-images">
                        ${order.imagemFaca?`<div class="order-image"><h4>Imagem da Faca</h4><img src="${order.imagemFaca}" alt="Faca"></div>`:''}
                        ${order.imagemArte?`<div class="order-image"><h4>Montagem da Arte</h4><img src="${order.imagemArte}" alt="Arte"></div>`:''}
                    </div>`:''}

                    <div style="margin:15px 0;">
                        <strong>Acabamento:</strong>
                        <p style="margin-top:5px;background:#f8f9fa;padding:10px;border-radius:5px;">${order.acabamento}</p>
                    </div>

                    <div style="margin:15px 0;">
                        <strong>Descrição das Embalagens:</strong>
                        <p style="margin-top:5px;background:#f8f9fa;padding:10px;border-radius:5px;">${order.descricaoEmbalagens}</p>
                    </div>

                    <div class="order-actions">
                        <button class="btn btn-primary" onclick="printOrderModal('${order.id}')">🖨️ Imprimir</button>
                        <button class="btn btn-success" onclick="advanceStep('${order.id}')">➡️ Próxima Etapa</button>
                        <button class="btn btn-warning" onclick="editOrder('${order.id}')">✏️ Editar</button>
                        <button class="btn btn-info btn-small" onclick="duplicateOrder('${order.id}')">📋 Duplicar</button>
                        <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">🗑️ Excluir</button>
                    </div>
                </div>`;
            }).join('');
        }

        function duplicateOrder(orderId){
            const order=orders.find(o=>o.id===orderId);
            if(!order){showNotification('Erro: Ordem não encontrada!','error');return;}
            fillFormWithTemplate(order);
            document.getElementById('quantidade').value='';
            document.getElementById('status').value='Em Andamento';
            showNotification(`Dados da ordem ${orderId} carregados para nova ordem!`,'success');
            document.querySelector('.main-content').scrollIntoView({behavior:'smooth'});
        }

        function displayOrders(){displayOrdersList(orders);}
        function advanceStep(orderId){const order=orders.find(o=>o.id===orderId);if(order&&order.currentStep<4){order.currentStep++;if(order.currentStep===4){order.status='Finalizado';}localStorage.setItem('productionOrders',JSON.stringify(orders));displayOrders();updateStats();showNotification(`Ordem ${orderId} avançou para a próxima etapa!`,'success');}}
        function deleteOrder(orderId){if(confirm('Tem certeza que deseja excluir esta ordem de produção?')){orders=orders.filter(o=>o.id!==orderId);localStorage.setItem('productionOrders',JSON.stringify(orders));displayOrders();updateStats();showNotification(`Ordem ${orderId} excluída com sucesso!`,'info');}}

        /* IMPRESSÃO – sem bloco de processo e preservando formatação dos textos */
        function printOrderModal(orderId){
            const order=orders.find(o=>o.id===orderId);
            if(!order){showNotification('Ordem não encontrada!','error');return;}

            const printHTML = `
                <div class="print-header">
                    <h1 style="color:#2c3e50;font-size:22px;margin:0 0 6px 0;">ORDEM DE PRODUÇÃO</h1>
                    <h2 style="color:#667eea;font-size:18px;margin:0 0 6px 0;">${order.id}</h2>
                    ${order.nomeTemplate?`<h3 style="color:#2c3e50;font-size:16px;margin:0 0 6px 0;">📦 ${order.nomeTemplate}</h3>`:''}
                    <p style="color:#666;margin:2px 0;">Data: ${order.dataCreated} ${order.timeCreated?'às '+order.timeCreated:''}</p>
                    <p style="color:#666;margin:2px 0;">Status: ${order.status} | Prioridade: ${order.prioridade||'Média'}</p>
                    ${order.lastModified?`<p style="color:#e67e22;margin:2px 0;font-size:12px;">Última edição: ${order.lastModified}</p>`:''}
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:8px 0;">
                    <div>
                        <h3 style="color:#2c3e50;margin-bottom:8px;font-size:14px;">📏 Especificações</h3>
                        <table style="width:100%;border-collapse:collapse;">
                            <tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Medidas da Folha:</td><td style="padding:6px 0;color:#333;">${order.medidasFolha}</td></tr>
                            <tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Quantidade:</td><td style="padding:6px 0;color:#333;">${parseInt(order.quantidade).toLocaleString()}</td></tr>
                            ${order.folhasResma?`<tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Folhas/Resma:</td><td style="padding:6px 0;color:#333;">${order.folhasResma}</td></tr>`:''}
                            <tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Tipo de Papel:</td><td style="padding:6px 0;color:#333;">${order.tipoPapel}</td></tr>
                            <tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Gramatura:</td><td style="padding:6px 0;color:#333;">${order.gramatura}</td></tr>
                            <tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Impressão:</td><td style="padding:6px 0;color:#333;">${order.impressao}</td></tr>
                            ${order.fornecedor?`<tr style="border-bottom:1px solid #ddd;"><td style="padding:6px 0;font-weight:bold;color:#333;">Fornecedor:</td><td style="padding:6px 0;color:#333;">${order.fornecedor}</td></tr>`:''}
                        </table>
                    </div>

                    ${order.imagemFaca||order.imagemArte?`
                    <div>
                        <h3 style="color:#2c3e50;margin-bottom:8px;font-size:14px;">🖼️ Imagens</h3>
                        <div class="print-images" style="grid-template-columns:1fr 1fr;gap:10px;margin:0;">
                            ${order.imagemFaca?`<div class="print-image" style="text-align:center;"><div style="font-size:12px;margin-bottom:4px;">🔧 Faca</div><img src="${order.imagemFaca}" alt="Faca" style="max-height:220px;border:1px solid #ddd;border-radius:8px;"></div>`:''}
                            ${order.imagemArte?`<div class="print-image" style="text-align:center;"><div style="font-size:12px;margin-bottom:4px;">🎨 Arte</div><img src="${order.imagemArte}" alt="Arte" style="max-height:220px;border:1px solid #ddd;border-radius:8px;"></div>`:''}
                        </div>
                    </div>`:`<div></div>`}
                </div>

                <div style="margin:8px 0;">
                    <h3 style="color:#2c3e50;margin-bottom:6px;font-size:14px;">🎨 Acabamento</h3>
                    <div style="background:#f8f9fa;padding:10px;border-radius:8px;border-left:4px solid #667eea;">
                        <pre style="white-space:pre-wrap;margin:0;font-size:13px;line-height:1.45;color:#333;">${order.acabamento}</pre>
                    </div>
                </div>

                <div style="margin:8px 0;">
                    <h3 style="color:#2c3e50;margin-bottom:6px;font-size:14px;">📦 Descrição das Embalagens</h3>
                    <div style="background:#f8f9fa;padding:10px;border-radius:8px;border-left:4px solid #667eea;">
                        <pre style="white-space:pre-wrap;margin:0;font-size:13px;line-height:1.45;color:#333;">${order.descricaoEmbalagens}</pre>
                    </div>
                </div>
            `;
            document.getElementById('printContent').innerHTML=printHTML;
            document.getElementById('printModal').style.display='block';
            const modal=document.getElementById('printModal');const modalContent=document.getElementById('printContent');
            modal.style.visibility='visible';modalContent.style.visibility='visible';modalContent.style.display='block';
            showNotification('Preview da impressão carregado!','success');
        }

        function closePrintModal(){document.getElementById('printModal').style.display='none';}
        function printOrder(){
            const modal=document.getElementById('printModal');
            const content=document.getElementById('printContent');
            if(modal.style.display==='none'||!content.innerHTML.trim()){showNotification('Erro: Nenhum conteúdo para imprimir!','error');return;}
            content.style.display='block';content.style.visibility='visible';
            setTimeout(()=>{try{window.print();showNotification('Enviando para impressão...','info');}catch(e){console.error(e);showNotification('Erro ao imprimir. Tente novamente.','error');}},300);
        }

        function exportData(){
            if(orders.length===0){showNotification('Nenhuma ordem para exportar.','info');return;}
            const dataStr=JSON.stringify({orders,productTemplates},null,2);
            const blob=new Blob([dataStr],{type:'application/json'});
            const url=URL.createObjectURL(blob);
            const a=document.createElement('a');a.href=url;a.download=`ordens_producao_completo_${new Date().toISOString().split('T')[0]}.json`;a.click();
            showNotification('Dados exportados com sucesso!','success');
        }
        function importData(){document.getElementById('importFile').click();}
        function handleImport(ev){
            const file=ev.target.files[0];if(!file)return;
            const r=new FileReader();
            r.onload=e=>{
                try{
                    const imported=JSON.parse(e.target.result);
                    if(imported.orders&&Array.isArray(imported.orders)){
                        orders=imported.orders;
                        if(imported.productTemplates&&Array.isArray(imported.productTemplates)){productTemplates=imported.productTemplates;localStorage.setItem('productTemplates',JSON.stringify(productTemplates));}
                        localStorage.setItem('productionOrders',JSON.stringify(orders));displayOrders();updateStats();showNotification('Dados importados com sucesso!','success');
                    }else if(Array.isArray(imported)){
                        orders=imported;localStorage.setItem('productionOrders',JSON.stringify(orders));displayOrders();updateStats();showNotification('Dados importados com sucesso!','success');
                    }else{throw new Error('Formato inválido');}
                }catch(err){showNotification('Erro ao importar dados. Verifique o formato do arquivo.','error');}
            };
            r.readAsText(file);
        }

        function clearAllData(){
            if(confirm('ATENÇÃO: Isso irá excluir TODAS as ordens de produção E modelos salvos. Esta ação não pode ser desfeita. Deseja continuar?')){
                orders=[];productTemplates=[];orderIdCounter=1;
                localStorage.removeItem('productionOrders');localStorage.removeItem('productTemplates');localStorage.removeItem('orderIdCounter');
                displayOrders();updateStats();showNotification('Todos os dados foram removidos.','info');
            }
        }

        displayOrders();updateStats();

        window.onclick=function(e){
            const pm=document.getElementById('printModal');
            const em=document.getElementById('editModal');
            const tm=document.getElementById('templatesModal');
            if(e.target===pm)closePrintModal();
            if(e.target===em)closeEditModal();
            if(e.target===tm)closeTemplatesModal();
        }

        setInterval(()=>{if(orders.length>0)localStorage.setItem('productionOrders',JSON.stringify(orders));if(productTemplates.length>0)localStorage.setItem('productTemplates',JSON.stringify(productTemplates));},30000);

        window.addEventListener('beforeprint',function(){const pc=document.getElementById('printContent');if(pc){pc.style.display='block !important';pc.style.visibility='visible !important';}});
        window.addEventListener('afterprint',function(){showNotification('Impressão enviada!','success');});
    </script>
</body>
</html>
